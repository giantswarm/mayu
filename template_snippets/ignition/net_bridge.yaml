{{define "net_bridge"}}
networkd:
  units:
  - name: 00-{{.Host.ConnectedNIC}}.network
    contents: |
      [Match]
      Name={{.Host.ConnectedNIC}}

      [Network]
      Address={{.Host.InternalAddr}}/22
      Gateway={{.ClusterNetwork.Router}}
      {{ range $server := .ClusterNetwork.DNS }}DNS={{ $server }}
      {{ end }}
  - name: 30-br0.netdev
    contents: |
      [NetDev]
      Name=br0
      Kind=bridge
  - name: 30-br0.network
    contents: |
      [Match]
      Name=br0
      [Network]
      Address={{.Host.BridgeIP}}/24
      DHCPServer=yes
      {{ range $server := .ClusterNetwork.DNS }}DNS={{ $server }}
      {{ end }}
      IPMasquerade=yes
  - name: 99-nodhcp.network
    contents: |
      [Match]
      Name=*

      [Network]
      DHCP=no
{{end}}
